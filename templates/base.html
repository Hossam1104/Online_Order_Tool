<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Order Tool</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Cairo Font -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
<div class="app-container">
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h4>Online Order Tool</h4>
            <p class="mb-0">Order Management System</p>
        </div>

        <div class="sidebar-content">
            <!-- Theme Selector -->
            <div class="theme-toggle">
                <button class="theme-toggle-btn">
                    <i class="bi bi-sun"></i>
                    <span>Light Mode</span>
                </button>
            </div>


            <div class="theme-selector">
                <div class="theme-color blue active" data-color="blue"></div>
                <div class="theme-color purple" data-color="purple"></div>
                <div class="theme-color green" data-color="green"></div>
                <div class="theme-color orange" data-color="orange"></div>
                <div class="theme-color red" data-color="red"></div>
            </div>


            <div class="theme-selector mb-3 px-3">
                <h6 class="text-primary mb-2"><i class="bi bi-palette me-2"></i>Theme Colors</h6>
                <div class="d-flex justify-content-between">
                    <div class="theme-color blue active" data-color="blue"></div>
                    <div class="theme-color purple" data-color="purple"></div>
                    <div class="theme-color green" data-color="green"></div>
                    <div class="theme-color orange" data-color="orange"></div>
                    <div class="theme-color red" data-color="red"></div>
                </div>
            </div>
            <div class="theme-selector mb-3 px-3">
                <h6 class="text-primary mb-2"><i class="bi bi-palette me-2"></i>Theme Colors</h6>
                <div class="d-flex justify-content-between">
                    <div class="theme-color blue active" data-color="blue"></div>
                    <div class="theme-color purple" data-color="purple"></div>
                    <div class="theme-color green" data-color="green"></div>
                    <div class="theme-color orange" data-color="orange"></div>
                    <div class="theme-color red" data-color="red"></div>
                </div>
            </div>
            <!-- Navigation -->
            <ul class="nav flex-column">
                <li class="nav-item">
                    <a class="nav-link active" href="#order-tab" data-bs-toggle="tab">
                        <i class="bi bi-cart"></i> Order Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#api-tab" data-bs-toggle="tab">
                        <i class="bi bi-gear"></i> API Configuration
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#database-tab" data-bs-toggle="tab">
                        <i class="bi bi-database"></i> Database Connection
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#test-tab" data-bs-toggle="tab">
                        <i class="bi bi-plug"></i> Test Endpoints
                    </a>
                </li>
            </ul>

            <div class="mt-4 px-3">
                <h6 class="text-primary mb-3"><i class="bi bi-graph-up"></i> Quick Stats</h6>
                <div class="stat-card">
                    <div class="stat-number">{{ products|length }}</div>
                    <div class="stat-label">PRODUCTS</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">{{ payments|length }}</div>
                    <div class="stat-label">PAYMENTS</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="sidebar-total">0.00</div>
                    <div class="stat-label">TOTAL</div>
                </div>
            </div>

            <div class="mt-4 px-3">
                <h6 class="text-primary mb-3"><i class="bi bi-lightning"></i> Quick Actions</h6>
                <div class="d-grid gap-2">
                    <a href="{{ url_for('load_default') }}" class="btn btn-outline-primary">
                        <i class="bi bi-arrow-clockwise"></i> Load Default
                    </a>
                    <a href="{{ url_for('clear_all') }}" class="btn btn-outline-primary">
                        <i class="bi bi-trash"></i> Clear All
                    </a>
                    <a href="{{ url_for('export_json') }}" class="btn btn-outline-primary" target="_blank">
                        <i class="bi bi-download"></i> Export JSON
                    </a>
                    <a href="#api-tab" class="btn btn-outline-primary" data-bs-toggle="tab">
                        <i class="bi bi-send"></i> Send Request
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content fade-in">
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            <i class="bi {% if category == 'success' %}bi-check-circle{% elif category == 'danger' %}bi-exclamation-triangle{% elif category == 'warning' %}bi-exclamation-circle{% else %}bi-info-circle{% endif %} me-2"></i>
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
        {% endif %}
        {% endwith %}

        <div class="tab-content">
            <!-- Order Details Tab -->
            <div class="tab-pane fade show active" id="order-tab">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="section-title">Order Details</h2>
                    <div class="d-flex gap-2">
                        <button class="btn btn-outline-primary" id="calculateTotals">
                            <i class="bi bi-calculator"></i> Calculate Totals
                        </button>
                        <a href="{{ url_for('export_json') }}" class="btn btn-success" target="_blank">
                            <i class="bi bi-download"></i> Export JSON
                        </a>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="quick-stats">
                    <div class="quick-stat">
                        <div class="quick-stat-number" id="productsTotal">0.00</div>
                        <div class="quick-stat-label">Products Total</div>
                    </div>
                    <div class="quick-stat">
                        <div class="quick-stat-number" id="orderDiscount">0.00</div>
                        <div class="quick-stat-label">Order Discount</div>
                    </div>
                    <div class="quick-stat">
                        <div class="quick-stat-number" id="deliveryCost">0.00</div>
                        <div class="quick-stat-label">Delivery Cost</div>
                    </div>
                    <div class="quick-stat">
                        <div class="quick-stat-number text-primary" id="finalTotal">0.00</div>
                        <div class="quick-stat-label">Final Total</div>
                    </div>
                </div>

                <div class="grid-container">
                    <!-- Order Information Card -->
                    <div class="grid-item">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="bi bi-info-circle me-2"></i>Order Information</h5>
                            </div>
                            <div class="card-body">
                                <form method="POST" action="{{ url_for('update_order') }}">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label class="form-label">Branch Code</label>
                                            <input type="text" class="form-control" name="branch_code" value="{{ data.branch_code }}">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Order Code</label>
                                            <input type="text" class="form-control" name="order_code" value="{{ data.order_code }}">
                                        </div>

                                        <div class="col-12">
                                            <label class="form-label">Parent Order Code (For Returns)</label>
                                            <input type="text" class="form-control" name="parent_order_code" value="{{ data.parent_order_code }}"
                                                   placeholder="Enter parent order code for returns">
                                        </div>

                                        <div class="col-md-4">
                                            <label class="form-label">Delivery Cost</label>
                                            <input type="number" step="0.01" class="form-control" name="delivery_cost"
                                                   value="{{ data.order_delivery_cost }}">
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">Is Delivery</label>
                                            <select class="form-select" name="is_delivery">
                                                <option value="1" {% if data.is_delivery== 1 %}selected{% endif %}>Yes</option>
                                                <option value="0" {% if data.is_delivery== 0 %}selected{% endif %}>No</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4">
                                            <label class="form-label">Order Status</label>
                                            <select class="form-select" name="order_status">
                                                <option value="new" {% if data.order_status=='new' %}selected{% endif %}>New</option>
                                                <option value="cancelled" {% if data.order_status=='cancelled' %}selected{% endif %}>Cancelled
                                                </option>
                                                <option value="confirmed" {% if data.order_status=='confirmed' %}selected{% endif %}>Confirmed
                                                </option>
                                                <option value="done" {% if data.order_status=='done' %}selected{% endif %}>Done</option>
                                                <option value="return" {% if data.order_status=='return' %}selected{% endif %}>Return</option>
                                            </select>
                                        </div>

                                        <div class="col-md-6">
                                            <label class="form-label">Delivery Date</label>
                                            <input type="date" class="form-control" name="delivery_date" value="{{ data.delivery_date }}">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Fulfillment Plant</label>
                                            <input type="text" class="form-control" name="fulfillment_plant" value="{{ data.fullfilment_plant }}">
                                        </div>

                                        <div class="col-12">
                                            <label class="form-label">Shipping Address 2</label>
                                            <input type="text" class="form-control" name="shipping_address_2" value="{{ data.shipping_address_2 }}">
                                        </div>

                                        <div class="col-12">
                                            <label class="form-label">Order Notes</label>
                                            <textarea class="form-control" name="order_notes" rows="2">{{ data.order_notes }}</textarea>
                                        </div>

                                        <div class="col-12">
                                            <button type="submit" class="btn btn-primary w-100">
                                                <i class="bi bi-check-circle me-2"></i>Update Order
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- Client Information Card -->
                    <div class="grid-item">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="bi bi-person me-2"></i>Client Information</h5>
                            </div>
                            <div class="card-body">
                                <form method="POST" action="{{ url_for('update_order') }}">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label class="form-label">First Name</label>
                                            <input type="text" class="form-control" name="first_name" value="{{ data.client_first_name }}">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Last Name</label>
                                            <input type="text" class="form-control" name="last_name" value="{{ data.client_last_name }}">
                                        </div>

                                        <div class="col-md-6">
                                            <label class="form-label">Middle Name</label>
                                            <input type="text" class="form-control" name="middle_name" value="{{ data.client_middle_name }}">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Phone</label>
                                            <input type="text" class="form-control" name="phone" value="{{ data.client_phone }}">
                                        </div>

                                        <div class="col-md-6">
                                            <label class="form-label">Email</label>
                                            <input type="email" class="form-control" name="email" value="{{ data.client_email }}">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Birthdate</label>
                                            <input type="date" class="form-control" name="birthdate"
                                                   value="{{ data.client_birthdate[:10] if data.client_birthdate }}">
                                        </div>

                                        <div class="col-md-6">
                                            <label class="form-label">Gender</label>
                                            <select class="form-select" name="gender">
                                                <option value="Male" {% if data.client_gender=='Male' %}selected{% endif %}>Male</option>
                                                <option value="Female" {% if data.client_gender=='Female' %}selected{% endif %}>Female</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Country Code</label>
                                            <input type="text" class="form-control" name="country_code" value="{{ data.client_country_code }}">
                                        </div>

                                        <div class="col-12">
                                            <label class="form-label">Address</label>
                                            <input type="text" class="form-control" name="address" value="{{ data.order_address }}">
                                        </div>

                                        <div class="col-12">
                                            <button type="submit" class="btn btn-primary w-100">
                                                <i class="bi bi-check-circle me-2"></i>Update Client
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- Delivery Information Card -->
                    <div class="grid-item">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="bi bi-truck me-2"></i>Delivery Information</h5>
                            </div>
                            <div class="card-body">
                                <form method="POST" action="{{ url_for('update_order') }}">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label class="form-label">From Time (HH:MM:SS)</label>
                                            <input type="text" class="form-control" name="delivery_from_time" value="{{ data.delivery_from_time }}"
                                                   placeholder="12:23:10.323">
                                            <small class="text-muted">Format: HH:MM:SS or HH:MM:SS.mmm</small>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">To Time (HH:MM:SS)</label>
                                            <input type="text" class="form-control" name="delivery_to_time" value="{{ data.delivery_to_time }}"
                                                   placeholder="03:23:10">
                                            <small class="text-muted">Format: HH:MM:SS or HH:MM:SS.mmm</small>
                                        </div>
                                        <div class="col-12">
                                            <label class="form-label">Payment Status</label>
                                            <select class="form-select" name="order_payment_status">
                                                {% for status in payment_statuses %}
                                                <option value="{{ status }}" {% if data.order_payment_status== status %}selected{% endif %}>{{
                                                    status|replace('_',
                                                    ' ')|title }}
                                                </option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        <div class="col-12">
                                            <button type="submit" class="btn btn-primary w-100">
                                                <i class="bi bi-check-circle me-2"></i>Update Delivery
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Products Card -->
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="bi bi-cart me-2"></i>Products ({{ products|length }})</h5>
                        <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addProductModal">
                            <i class="bi bi-plus"></i> Add Product
                        </button>
                    </div>
                    <div class="card-body">
                        {% if products %}
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Qty</th>
                                    <th>Price</th>
                                    <th>Discount</th>
                                    <th>VAT %</th>
                                    <th>Total</th>
                                    <th>Actions</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for product in products %}
                                <tr>
                                    <td>
                                        <div class="fw-bold">{{ product.item_name }}</div>
                                        <small class="text-muted">{{ product.item_code }}</small>
                                        {% if product.offer_code %}
                                        <div class="text-info small mt-1">
                                            <i class="bi bi-tag"></i> {{ product.offer_code }}
                                            {% if product.offer_message %} - {{ product.offer_message }}{% endif %}
                                        </div>
                                        {% endif %}
                                    </td>
                                    <td>{{ product.quantity }}</td>
                                    <td>${{ product.unit_price }}</td>
                                    <td>${{ product.row_total_discount }}</td>
                                    <td>{{ (product.vat_percentage * 100)|round(2) }}%</td>
                                    <td class="fw-bold">${{ product.row_net_total }}</td>
                                    <td>
                                        <div class="btn-group">
                                            <button class="btn btn-sm btn-outline-primary edit-product" data-index="{{ loop.index0 }}">
                                                <i class="bi bi-pencil"></i>
                                            </button>
                                            <a href="{{ url_for('remove_product', index=loop.index0) }}" class="btn btn-sm btn-outline-danger">
                                                <i class="bi bi-trash"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <div class="text-center text-muted py-4">
                            <i class="bi bi-cart-x display-4"></i>
                            <p class="mt-3">No products added yet</p>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Payment Methods Card -->
                <div class="card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="bi bi-credit-card me-2"></i>Payment Methods ({{ payments|length }})</h5>
                        <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addPaymentModal">
                            <i class="bi bi-plus"></i> Add Payment
                        </button>
                    </div>
                    <div class="card-body">
                        {% if payments %}
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                <tr>
                                    <th>Payment Method</th>
                                    <th>Payment Status</th>
                                    <th>Amount</th>
                                    <th>Transaction ID</th>
                                    <th>Payment Option</th>
                                    <th>Commission</th>
                                    <th>Customer Info</th>
                                    <th>Actions</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for payment in payments %}
                                <tr>
                                    <td>{{ payment.payment_method }}</td>
                                    <td>{{ payment.payment_status }}</td>
                                    <td>{{ payment.payment_amount }}</td>
                                    <td>{{ payment.transaction_id }}</td>
                                    <td>{{ payment.payment_option }}</td>
                                    <td>{{ payment.option_commission }}</td>
                                    <td>
                                        {% if payment.credit_customer_info %}
                                        {{ payment.credit_customer_info.customer_name }} ({{ payment.credit_customer_info.customer_number }})
                                        {% else %}
                                        -
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div class="btn-group">
                                            <button class="btn btn-sm btn-outline-primary edit-payment" data-index="{{ loop.index0 }}">
                                                <i class="bi bi-pencil"></i>
                                            </button>
                                            <a href="{{ url_for('remove_payment', index=loop.index0) }}" class="btn btn-sm btn-outline-danger">
                                                <i class="bi bi-trash"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <div class="text-center text-muted py-4">
                            <i class="bi bi-credit-card display-4"></i>
                            <p class="mt-3">No payment methods added yet</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- API Configuration Tab -->
            <div class="tab-pane fade" id="api-tab">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="section-title">API Configuration</h2>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-gear me-2"></i>API Settings</h5>
                    </div>
                    <div class="card-body">
                        <form method="POST" action="{{ url_for('send_request') }}">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">Select API Endpoint</label>
                                    <select class="form-select" name="api_endpoint" id="apiEndpoint">
                                        {% for name, url in api_urls.items() %}
                                        <option value="{{ name }}" {% if selected_endpoint==name %}selected{% endif %}>{{ name }} - {{ url }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Or Enter Custom URL</label>
                                    <input type="url" class="form-control" name="custom_url" placeholder="https://example.com/api/orders">
                                </div>
                                <div class="col-12">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="validateBeforeSend" checked>
                                        <label class="form-check-label" for="validateBeforeSend">
                                            Validate data before sending
                                        </label>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <button type="submit" class="btn btn-primary w-100">
                                        <i class="bi bi-send me-2"></i>Send Request
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                {% if response %}
                <div class="card mt-4">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-response me-2"></i>API Response</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <strong>Status Code:</strong> {{ response.status_code }}
                        </div>
                        <div class="mb-3">
                            <strong>URL Sent:</strong> {{ response.url_sent }}
                        </div>
                        <div>
                            <strong>Response:</strong>
                            <pre class="bg-light p-3 rounded">{{ response.response_text|tojson|safe }}</pre>
                        </div>
                    </div>
                </div>

                <!-- Add Cancel Order section -->
                <div class="card mt-4">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-x-circle me-2"></i>Cancel Order</h5>
                    </div>
                    <div class="card-body">
                        <form method="POST" action="{{ url_for('cancel_order') }}">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label">Select API Endpoint</label>
                                    <select class="form-select" name="cancel_api_endpoint" required>
                                        <option value="">Select Endpoint</option>
                                        {% for name, url in cancel_api_urls.items() %}
                                        <option value="{{ name }}">{{ name }} - {{ url }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Or Enter Custom URL</label>
                                    <input type="url" class="form-control" name="cancel_custom_url"
                                           placeholder="https://example.com/api/Order/CancelOrder">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Order Number</label>
                                    <input type="text" class="form-control" name="order_number" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Reason</label>
                                    <input type="text" class="form-control" name="reason" required>
                                </div>
                                <div class="col-12">
                                    <button type="submit" class="btn btn-danger w-100">
                                        <i class="bi bi-x-circle me-2"></i>Cancel Order
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

                {% endif %}
            </div>

            <!-- Database Connection Tab -->
            <div class="tab-pane fade" id="database-tab">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="section-title">Database Connection</h2>
                </div>

                <div class="row">
                    <div class="col-lg-6">
                        <div class="card h-100">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="bi bi-database me-2"></i>Database Settings</h5>
                            </div>
                            <div class="card-body">
                                <form id="databaseForm">
                                    <div class="row g-3">
                                        <div class="col-12">
                                            <label class="form-label">Server</label>
                                            <input type="text" class="form-control" name="server" value=".">
                                        </div>
                                        <div class="col-12">
                                            <label class="form-label">Database</label>
                                            <input type="text" class="form-control" name="database" value="RMSCashierSrv">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Username</label>
                                            <input type="text" class="form-control" name="username" value="sa">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Password</label>
                                            <input type="password" class="form-control" name="password" value="P@ssw0rd">
                                        </div>
                                        <div class="col-12">
                                            <button type="button" id="testDatabase" class="btn btn-primary w-100">
                                                <i class="bi bi-plug me-2"></i>Test Connection
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-6">
                        <div class="card h-100">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="bi bi-search me-2"></i>Item Lookup</h5>
                            </div>
                            <div class="card-body">
                                <form id="itemLookupForm">
                                    <div class="row g-3">
                                        <div class="col-12">
                                            <label class="form-label">Material Number (6 digits)</label>
                                            <input type="text" class="form-control" name="material_number" placeholder="123456" maxlength="6"
                                                   required>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Customer Number (Optional)</label>
                                            <input type="text" class="form-control" name="customer_number" placeholder="Customer number">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">SAP Tax Code (Optional)</label>
                                            <input type="text" class="form-control" name="sap_tax_code" placeholder="Tax code">
                                        </div>
                                        <div class="col-12">
                                            <label class="form-label">SAP Material Generic (Optional)</label>
                                            <input type="text" class="form-control" name="sap_mat_generic" placeholder="Material generic">
                                        </div>
                                        <div class="col-12">
                                            <button type="submit" class="btn btn-primary w-100">
                                                <i class="bi bi-search me-2"></i>Search Item
                                            </button>
                                        </div>
                                    </div>
                                </form>

                                <div id="itemResults" class="mt-4" style="display: none;">
                                    <h6>Item Details</h6>
                                    <div class="table-responsive">
                                        <table class="table table-striped">
                                            <tbody id="itemDetails">
                                            <!-- Item details will be populated here -->
                                            </tbody>
                                        </table>
                                    </div>
                                    <button id="addItemToOrder" class="btn btn-success w-100">
                                        <i class="bi bi-plus-circle me-2"></i>Add to Order
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Test Endpoints Tab -->
            <div class="tab-pane fade" id="test-tab">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="section-title">Test Endpoints</h2>
                    <button id="testAllEndpoints" class="btn btn-primary">
                        <i class="bi bi-lightning-charge me-2"></i>Test All Endpoints
                    </button>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="bi bi-plug me-2"></i>API Endpoints Status</h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                <tr>
                                    <th>Endpoint Name</th>
                                    <th>URL</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                                </thead>
                                <tbody id="endpointsTable">
                                {% for name, url in api_urls.items() %}
                                <tr>
                                    <td>{{ name }}</td>
                                    <td>{{ url }}</td>
                                    <td><span class="badge bg-secondary">Not Tested</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary test-single-endpoint" data-name="{{ name }}"
                                                data-url="{{ url }}">
                                            Test
                                        </button>
                                    </td>
                                </tr>
                                {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Theme Switcher -->
<div class="theme-switcher">
    <button class="btn btn-primary rounded-circle p-3" id="themeToggle">
        <i class="bi bi-sun"></i>
    </button>
    <button class="btn btn-primary rounded-circle p-3 mt-2" id="themeColorToggle">
        <i class="bi bi-palette"></i>
    </button>
</div>

<!-- Theme Selector -->
<div class="theme-selector" id="themeSelector">
    <div class="theme-color blue active" data-color="blue"></div>
    <div class="theme-color purple" data-color="purple"></div>
    <div class="theme-color green" data-color="green"></div>
    <div class="theme-color orange" data-color="orange"></div>
    <div class="theme-color red" data-color="red"></div>
</div>

<!-- Bootstrap & Vanilla JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- Custom JS -->
<script src="{{ url_for('static', filename='js/script.js') }}"></script>

<!-- Add Product Modal -->
<div class="modal fade" id="addProductModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Product</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="POST" action="{{ url_for('add_product') }}">
                <div class="modal-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Item Code</label>
                            <input type="text" class="form-control" name="item_code" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Item Name</label>
                            <input type="text" class="form-control" name="item_name" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Quantity</label>
                            <input type="number" step="0.01" class="form-control" name="quantity" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Unit Price</label>
                            <input type="number" step="0.01" class="form-control" name="unit_price" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">VAT %</label>
                            <input type="number" step="0.01" class="form-control" name="vat_percentage" value="0">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Discount</label>
                            <input type="number" step="0.01" class="form-control" name="discount" value="0">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Offer Code</label>
                            <input type="text" class="form-control" name="offer_code">
                        </div>
                        <div class="col-12">
                            <label class="form-label">Offer Message</label>
                            <input type="text" class="form-control" name="offer_message">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Estimated Total</label>
                            <input type="text" class="form-control" id="estimatedTotal" readonly value="$0.00">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Add Product</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Add Payment Modal -->
<div class="modal fade" id="addPaymentModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Payment Method</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="POST" action="{{ url_for('add_payment') }}">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Payment Method</label>
                                <select class="form-select" name="payment_method" id="paymentMethod" required>
                                    <option value="">Select Method</option>
                                    {% for method in payment_methods %}
                                    <option value="{{ method }}">{{ method }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Payment Status</label>
                                <select class="form-select" name="payment_status" required>
                                    <option value="">Select Status</option>
                                    {% for status in payment_statuses %}
                                    <option value="{{ status }}">{{ status|replace('_', ' ')|title }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Amount</label>
                                <input type="number" step="0.01" class="form-control" name="payment_amount" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Transaction ID</label>
                                <input type="text" class="form-control" name="transaction_id">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Payment Option</label>
                                <input type="text" class="form-control" name="payment_option">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Option Commission</label>
                                <input type="number" step="0.01" class="form-control" name="option_commission" value="0">
                            </div>
                        </div>
                    </div>

                    <!-- Credit Customer Info (shown only for credit payment methods) -->
                    <div id="creditCustomerInfo" style="display: none;">
                        <h6 class="mb-3">Credit Customer Information</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Customer Name</label>
                                    <input type="text" class="form-control" name="customer_name">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Customer Number</label>
                                    <input type="text" class="form-control" name="customer_number">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Add Payment</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Edit Product Modal -->
<div class="modal fade" id="editProductModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Product</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="POST" id="editProductForm">
                <div class="modal-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Item Code</label>
                            <input type="text" class="form-control" name="item_code" id="editItemCode" required>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Item Name</label>
                            <input type="text" class="form-control" name="item_name" id="editItemName" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Quantity</label>
                            <input type="number" step="0.01" class="form-control" name="quantity" id="editQuantity" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Unit Price</label>
                            <input type="number" step="0.01" class="form-control" name="unit_price" id="editUnitPrice" required>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">VAT %</label>
                            <input type="number" step="0.01" class="form-control" name="vat_percentage" id="editVatPercentage">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Discount</label>
                            <input type="number" step="0.01" class="form-control" name="discount" id="editDiscount">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Offer Code</label>
                            <input type="text" class="form-control" name="offer_code" id="editOfferCode">
                        </div>
                        <div class="col-12">
                            <label class="form-label">Offer Message</label>
                            <input type="text" class="form-control" name="offer_message" id="editOfferMessage">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Update Product</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Edit Payment Modal -->
<div class="modal fade" id="editPaymentModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Payment Method</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="POST" id="editPaymentForm">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Payment Method</label>
                                <select class="form-select" name="payment_method" id="editPaymentMethod" required>
                                    <option value="">Select Method</option>
                                    {% for method in payment_methods %}
                                    <option value="{{ method }}">{{ method }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Payment Status</label>
                                <select class="form-select" name="payment_status" id="editPaymentStatus" required>
                                    <option value="">Select Status</option>
                                    {% for status in payment_statuses %}
                                    <option value="{{ status }}">{{ status|replace('_', ' ')|title }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Amount</label>
                                <input type="number" step="0.01" class="form-control" name="payment_amount" id="editPaymentAmount" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Transaction ID</label>
                                <input type="text" class="form-control" name="transaction_id" id="editTransactionId">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Payment Option</label>
                                <input type="text" class="form-control" name="payment_option" id="editPaymentOption">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Option Commission</label>
                                <input type="number" step="0.01" class="form-control" name="option_commission" id="editOptionCommission" value="0">
                            </div>
                        </div>
                    </div>

                    <!-- Credit Customer Info (shown only for credit payment methods) -->
                    <div id="editCreditCustomerInfo" style="display: none;">
                        <h6 class="mb-3">Credit Customer Information</h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Customer Name</label>
                                    <input type="text" class="form-control" name="customer_name" id="editCustomerName">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Customer Number</label>
                                    <input type="text" class="form-control" name="customer_number" id="editCustomerNumber">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Update Payment</button>
                </div>
            </form>
        </div>
    </div>
</div>
</body>
</html>